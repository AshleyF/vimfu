<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VimFu Report</title>
    <style>
    body { font-family: sans-serif; text-align: center; }
    </style>
    <script src="keys.js"></script>
    <script>
      function clean(jsonString) {
        const dataCloseChar = {
          "{": "}",
          "[": "]",
          '"': '"',
        };

  if (!jsonString) return null;

  let string = jsonString
    .trim()
    .replace(/(\r\n|\n|\r|\s{2,})/gm, "")
    .replace(/(?<=:)([a-zA-Z]+)(?=\s*(?![,\}])(?:[,\}\s]|$))/g, " null");

  let missingChars = [];
  for (let i = 0; i < string.length; i++) {
    const char = string[i];
    if (char === missingChars[missingChars.length - 1]) {
      missingChars.pop();
    } else if (dataCloseChar[char]) {
      missingChars.push(dataCloseChar[char]);

      if (char === "{") {
        missingChars.push(":");
      }
    }
  }
  if (missingChars[missingChars.length - 1] === ":") {
    if (string[string.length - 1] !== "{") {
      missingChars[missingChars.length - 1] = ": null";
    } else {
      missingChars.pop();
    }
  }
  const missingCharsString = missingChars.reverse().join("");
  const completeString = string + missingCharsString;
  const cleanedString = completeString
    .replace(/"":/g, "")
    .replace(/":}|": }/g, '": null }')
    .replace(/,""}|,}|,\"\w+\"}/g, "}")
    .replace(/},]/g, "}]");

  return cleanedString;
      }
      function load() {
        // covered in videos
        let filter = {};
        Object.keys(keys.videos).forEach(k => {
          let vid = keys.videos[k];
          if (vid.keys) {
            vid.keys.forEach(k => {
              filter[k] = true;
            });
          }
        });
        //filter = {};
        // build table
        let count = 0;
        let htm = '<table>';
        Object.keys(keys.normal).forEach(k => {
          let key = keys.normal[k];
          if (!filter[k]) {
            count++;
            htm += '<tr>'
            htm += '<td align="right">' + key.form.replace('<', '&lt;').replace('>', '&gt;') + '</td><td>' + key.name + '</td><td align="left">' + key.description + '</td>';
            htm += '</tr>'
          }
        });
        document.getElementById('report').innerText = 'All (' + count + ')';
        document.getElementById('normal').innerHTML = htm;

        document.getElementById('report').innerText = clean('{ foo: "bar');
      }
    </script>
  </head>
  <body onload="load()">
    <h1 id="report"></h1>
    <div id="normal"></div>
  </body>
</html>
